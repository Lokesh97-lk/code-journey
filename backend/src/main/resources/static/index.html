<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeJourney | World of Code</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // SECURITY & REDIRECT FIX
        // This prevents the "Invalid URL" error by constructing a full address
        if (!localStorage.getItem('userToken')) {
            const loginUrl = new URL('login.html', window.location.href).href;
            window.location.href = loginUrl;
        }
    </script>
</head>
<body class="h-screen w-screen bg-slate-900 text-white flex flex-col md:flex-row overflow-hidden">

    <!-- MOBILE HEADER -->
    <header class="md:hidden bg-slate-900 border-b border-slate-800 p-4 flex justify-between items-center z-50">
        <span class="font-bold gradient-text text-lg">CodeJourney</span>
        <button id="mobileMenuBtn" class="text-slate-300 focus:outline-none">
            <i class="fa-solid fa-bars text-2xl"></i>
        </button>
    </header>

    <!-- MAIN LAYOUT -->
    <div class="flex-1 flex overflow-hidden relative md:pt-0 pt-[60px]">
        
        <!-- SIDEBAR -->
        <aside id="sidebar" class="absolute md:relative z-40 w-72 h-full bg-slate-900 border-r border-slate-800 flex flex-col transform -translate-x-full md:translate-x-0 transition-transform duration-300 shadow-2xl md:shadow-none">
            <div class="p-6 border-b border-slate-800 hidden md:block">
                <span class="text-2xl font-bold gradient-text">CodeJourney</span>
                <p class="text-xs text-slate-500 mt-1">Your Path to Mastery</p>
            </div>
            
            <nav class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
                <button onclick="switchTab('dashboard')" id="nav-dashboard" class="sidebar-link active">
                    <i class="fa-solid fa-chart-line w-5"></i> My Activity
                </button>
                <button onclick="switchTab('practice')" id="nav-practice" class="sidebar-link">
                    <i class="fa-solid fa-flask w-5"></i> Practice Lab
                </button>
                
                <div class="px-4 py-2 text-xs font-bold text-slate-500 uppercase tracking-wider mt-6">Library</div>
                <button onclick="switchTab('python')" id="nav-python" class="sidebar-link"><i class="fa-brands fa-python w-5"></i> Python (10)</button>
                <button onclick="switchTab('cpp')" id="nav-cpp" class="sidebar-link"><i class="fa-solid fa-code w-5"></i> C++ (10)</button>
                <button onclick="switchTab('sql')" id="nav-sql" class="sidebar-link"><i class="fa-solid fa-database w-5"></i> SQL (7)</button>
                <button onclick="switchTab('java')" id="nav-java" class="sidebar-link"><i class="fa-brands fa-java w-5"></i> Java (7)</button>
            </nav>

            <!-- CONTACT INFO -->
            <div class="p-4 border-t border-slate-800 bg-slate-900/80 backdrop-blur">
                <h4 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Connect with Lokesh</h4>
                <div class="flex space-x-5 mb-4 px-2">
                    <a href="mailto:lokesh972007@gmail.com" class="text-slate-400 hover:text-white transition transform hover:scale-110"><i class="fa-solid fa-envelope text-xl"></i></a>
                    <a href="https://www.instagram.com/_lokesh_.97?igsh=cGVnMzdlM2w2NGFn" target="_blank" class="text-slate-400 hover:text-pink-500 transition transform hover:scale-110"><i class="fa-brands fa-instagram text-xl"></i></a>
                    <a href="https://www.linkedin.com/in/lokesh-saravanan-517b88315?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app" target="_blank" class="text-slate-400 hover:text-sky-500 transition transform hover:scale-110"><i class="fa-brands fa-linkedin text-xl"></i></a>
                </div>
                <button id="logoutBtn" class="w-full py-2 bg-red-500/10 text-red-400 rounded-lg hover:bg-red-500/20 text-sm flex items-center justify-center gap-2">
                    <i class="fa-solid fa-right-from-bracket"></i> Logout
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main id="contentArea" class="flex-1 h-full overflow-y-auto p-4 md:p-8 scroll-smooth relative bg-slate-900 w-full">
            
            <!-- Zen Mode -->
            <div class="absolute top-4 right-4 hidden md:block z-30">
                <button id="zenModeBtn" class="text-xs text-slate-400 hover:text-sky-400 border border-slate-700 px-3 py-1 rounded-full hover:border-sky-500 transition flex items-center gap-2">
                    <i class="fa-solid fa-expand"></i> Zen Mode
                </button>
            </div>

            <!-- DASHBOARD -->
            <div id="view-dashboard" class="view-section max-w-5xl mx-auto animate-fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl md:text-4xl font-bold text-white">Welcome Back, <span id="userEmailDisplay" class="text-sky-400">Dev</span></h2>
                    <p class="text-slate-400 mt-2">Ready to master your 34 concepts?</p>
                </div>
                <div class="glass-panel p-6 rounded-xl min-h-[200px]">
                    <h3 class="text-xl font-semibold text-white mb-4 border-b border-slate-700 pb-2">My Activity</h3>
                    <div id="progress-list" class="space-y-3"></div>
                    <p id="no-progress-msg" class="text-slate-400 text-center py-8 hidden">
                        No activity yet.<br>Go to the <b>Library</b>, pick a concept, and write a test!
                    </p>
                </div>
            </div>

            <!-- PRACTICE LAB -->
            <div id="view-practice" class="view-section hidden max-w-4xl mx-auto animate-fade-in">
                <h2 class="text-3xl font-bold text-white mb-2">Practice Lab</h2>
                <p class="text-slate-400 mb-6">Write your own test case for the selected concept.</p>
                
                <div class="glass-panel p-6 rounded-xl relative overflow-hidden border border-slate-700">
                    <form id="practiceForm">
                        <div class="mb-4">
                            <label class="block text-sm font-bold text-slate-300 mb-2">Selected Concept</label>
                            <input type="text" name="topic" id="practiceTopic" class="w-full bg-slate-800 border border-slate-600 rounded-lg p-3 text-white focus:border-sky-500 outline-none font-mono" placeholder="Select a concept from the library..." required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-bold text-slate-300 mb-2">Your Implementation</label>
                            <textarea name="code" id="practiceCode" rows="12" class="w-full bg-[#0d1117] border border-slate-700 rounded-lg p-4 text-gray-300 font-mono text-sm focus:border-sky-500 outline-none leading-relaxed" placeholder="// Write your code here..." required></textarea>
                        </div>
                        <div class="flex flex-col md:flex-row gap-3">
                            <button type="submit" id="submitPracticeBtn" class="flex-1 bg-sky-600 hover:bg-sky-500 text-white font-bold py-3 rounded-lg transition flex justify-center items-center gap-2">
                                <i class="fa-solid fa-save"></i> Save Progress
                            </button>
                            <button type="button" id="analyzeBtn" class="flex-1 bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-lg transition flex justify-center items-center gap-2">
                                <i class="fa-solid fa-robot"></i> Analyze with Gemini
                            </button>
                        </div>
                    </form>
                    <div id="aiFeedback" class="mt-6 hidden border-t border-slate-700 pt-4 markdown-body text-sm text-slate-300"></div>
                    <div id="practiceResult" class="mt-3 text-center hidden"></div>
                </div>
            </div>

            <!-- LIBRARY VIEWS -->
            <div id="view-python" class="view-section hidden w-full animate-fade-in">
                <h2 class="text-3xl font-bold text-white mb-6 flex items-center gap-3"><i class="fa-brands fa-python text-yellow-400"></i> Python Concepts</h2>
                <div id="python-examples" class="grid grid-cols-1 xl:grid-cols-2 gap-6"></div>
            </div>
            <div id="view-cpp" class="view-section hidden w-full animate-fade-in">
                <h2 class="text-3xl font-bold text-white mb-6 flex items-center gap-3"><i class="fa-solid fa-code text-blue-500"></i> C++ Concepts</h2>
                <div id="cpp-examples" class="grid grid-cols-1 xl:grid-cols-2 gap-6"></div>
            </div>
            <div id="view-sql" class="view-section hidden w-full animate-fade-in">
                <h2 class="text-3xl font-bold text-white mb-6 flex items-center gap-3"><i class="fa-solid fa-database text-emerald-500"></i> SQL Concepts</h2>
                <div id="sql-examples" class="grid grid-cols-1 xl:grid-cols-2 gap-6"></div>
            </div>
            <div id="view-java" class="view-section hidden w-full animate-fade-in">
                <h2 class="text-3xl font-bold text-white mb-6 flex items-center gap-3"><i class="fa-brands fa-java text-orange-500"></i> Java Concepts</h2>
                <div id="java-examples" class="grid grid-cols-1 xl:grid-cols-2 gap-6"></div>
            </div>

        </main>
    </div>

    <!-- NEW LOGIC MODAL (Fixes Empty Box Issue) -->
    <div id="logicModal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-slate-800 border border-sky-500/30 w-full max-w-2xl mx-4 rounded-xl shadow-2xl transform scale-95 transition-transform duration-300 max-h-[85vh] flex flex-col">
            <div class="p-6 border-b border-slate-700 flex justify-between items-center bg-slate-900/50 rounded-t-xl">
                <h3 class="text-xl font-bold text-sky-400">Logic Explanation</h3>
                <button id="closeModal" class="text-slate-400 hover:text-white text-2xl leading-none">&times;</button>
            </div>
            <div id="logicBody" class="p-6 overflow-y-auto text-slate-300 space-y-4 leading-relaxed text-sm md:text-base min-h-[100px]">
                <!-- Content injected here -->
            </div>
        </div>
    </div>

    <script>
        const API_URL = "/api";
        const GEMINI_API_KEY = ""; 

        // --- FULL LOGIC DATABASE (Ensures no empty boxes) ---
        const logicData = {
            // PYTHON
            "py_1": "<h4>String Slicing <code>[::-1]</code></h4><p>The syntax is <code>[start:stop:step]</code>. By leaving start and stop empty, we select the whole string. A step of <code>-1</code> reads it backwards.</p>",
            "py_2": "<h4>In-Place Swap</h4><p>Python packs values into a tuple on the right <code>(b, a)</code> then unpacks them into variables on the left <code>a, b</code>. No temporary variable needed!</p>",
            "py_3": "<h4>Dictionary Merge <code>|</code></h4><p>The <code>|</code> operator (Python 3.9+) merges dicts. If keys overlap, the right-side dictionary wins.</p>",
            "py_4": "<h4>setdefault()</h4><p>Checks if a key exists. If not, inserts it with a default value (0). Useful for counting without errors.</p>",
            "py_5": "<h4>Regex Groups</h4><p><code>(0)?</code> = optional '0'. <code>\\d{10}</code> = exactly 10 digits. Parentheses capture parts of the match.</p>",
            "py_6": "<h4>Regex OR <code>|</code></h4><p><code>(man|woman)</code> matches 'man' OR 'woman'. This allows searching for multiple variations at once.</p>",
            "py_7": "<h4>Set Operations</h4><p><code>-</code> finds difference (in A not B). <code>^</code> finds symmetric difference (unique to A or B, not both).</p>",
            "py_8": "<h4>Palindrome</h4><p><code>casefold()</code> ignores case. <code>reversed()</code> flips it. If list(original) == list(reversed), it's a palindrome.</p>",
            "py_9": "<h4>File Hash</h4><p>Reads file in 1024-byte chunks to save RAM. Updates the SHA1 hash state with each chunk.</p>",
            "py_10": "<h4>List Flattening</h4><p>Logic: <code>for sublist in list</code> -> <code>for item in sublist</code>. Reads left-to-right in comprehension.</p>",

            // C++
            "cpp_1": "<h4>I/O Streams</h4><p><code>cin >></code> extracts input. <code>cout <<</code> inserts output to console.</p>",
            "cpp_2": "<h4>Quotient/Remainder</h4><p><code>/</code> is integer division (drops decimals). <code>%</code> is modulus (remainder).</p>",
            "cpp_3": "<h4>Boolean Logic</h4><p><code>isalpha</code> checks if char is a letter. <code>||</code> is logical OR to check vowel conditions.</p>",
            "cpp_4": "<h4>Quadratic Formula</h4><p>Calc discriminant <code>D = b*b - 4ac</code>. If D>0: 2 real roots. D=0: 1 real root. D<0: complex.</p>",
            "cpp_5": "<h4>For Loop</h4><p>Standard loop: Init <code>i=1</code>, Condition <code>i<=10</code>, Update <code>++i</code>. Runs body 10 times.</p>",
            "cpp_6": "<h4>Octal Conversion</h4><p>Base-8 system. Take last digit (<code>%10</code>), multiply by 8^pos, add to sum.</p>",
            "cpp_7": "<h4>Structs</h4><p>Groups variables (name, roll) under one type <code>student</code>. Accessed via dot <code>s.roll</code>.</p>",
            "cpp_8": "<h4>ASCII Filter</h4><p>Only appends char to new string if it falls in 'a-z' or 'A-Z' ASCII range.</p>",
            "cpp_9": "<h4>Freq Count</h4><p>Linear search O(n). Increment count every time <code>str[i]</code> matches target.</p>",
            "cpp_10": "<h4>Prime Check</h4><p>Divisible only by 1 and itself. Loop 2 to n/2. If <code>n%i==0</code>, not prime.</p>",

            // SQL
            "sql_1": "<h4>Calculated Columns</h4><p><code>amount+100</code> computes value on fly. Doesn't change DB data, just the view.</p>",
            "sql_2": "<h4>Subtraction</h4><p>Similar to addition. <code>amount-20</code> creates a temporary column 'offer_price'.</p>",
            "sql_3": "<h4>Multiplication</h4><p><code>amount*4</code> scales the value. useful for tax/quantity calcs.</p>",
            "sql_4": "<h4>Division</h4><p><code>amount/2</code> halves the value. Integer division rules may apply depending on DB.</p>",
            "sql_5": "<h4>Stored Proc</h4><p><code>DELIMITER //</code> tells SQL to treat the code block as one unit until <code>END //</code>.</p>",
            "sql_6": "<h4>Multi-Param Proc</h4><p>Accepts <code>cus_id</code> and <code>max_amt</code>. Uses logic AND to filter results.</p>",
            "sql_7": "<h4>BETWEEN</h4><p><code>BETWEEN X AND Y</code> includes both endpoints. Equivalent to <code>>= X AND <= Y</code>.</p>",

            // JAVA
            "java_1": "<h4>Quadratic</h4><p>Uses <code>Math.sqrt()</code>. Logic identical to C++ but uses strict type safety (double).</p>",
            "java_2": "<h4>Multiplication</h4><p><code>System.out.printf</code> allows formatted output (<code>%d</code> for integers).</p>",
            "java_3": "<h4>Switch Case</h4><p>Jumps to matching <code>case</code>. <code>break</code> stops execution falling into next case.</p>",
            "java_4": "<h4>Recursion (Sum)</h4><p>Calls itself <code>num + add(num-1)</code> until <code>num=0</code> (Base Case).</p>",
            "java_5": "<h4>Recursion (Rev)</h4><p>Takes first char, moves to end. Recurses on rest of string.</p>",
            "java_6": "<h4>For-Each</h4><p><code>for(double n : array)</code> iterates elements directly. No index `i` needed.</p>",
            "java_7": "<h4>Matrix Add</h4><p>Nested loops required. Outer loop rows `i`, inner loop cols `j`. Add index-wise.</p>"
        };

        // --- CODE EXAMPLES ---
        const codeExamples = {
            python: [
                { id: "py_1", title: "1. Slicing", code: `a = "Hello World!"\nprint(a[::-1])` },
                { id: "py_2", title: "2. Inplace Swap", code: `a = 10; b = 5\na, b = b, a` },
                { id: "py_3", title: "3. Dictionary Merge", code: `a = {x:1}; b = {y:2}\nres = a | b` },
                { id: "py_4", title: "4. setdefault()", code: `c = {}\nc.setdefault('word', 0)\nc['word'] += 1` },
                { id: "py_5", title: "5. Regex Match", code: `re.search(r"(\+44)?\d{10}", text)` },
                { id: "py_6", title: "6. Regex Pipe", code: `re.search(r"Super(man|woman)", text)` },
                { id: "py_7", title: "7. Set Diff", code: `set(list2) - set(list1)` },
                { id: "py_8", title: "8. Palindrome", code: `if list(s) == list(reversed(s))` },
                { id: "py_9", title: "9. File Hash", code: `h = hashlib.sha1()\nh.update(chunk)` },
                { id: "py_10", title: "10. Flatten List", code: `[i for sub in list for i in sub]` }
            ],
            cpp: [
                { id: "cpp_1", title: "1. User Input", code: `cin >> number;\ncout << number;` },
                { id: "cpp_2", title: "2. Quotient/Rem", code: `q = div / div;\nr = div % div;` },
                { id: "cpp_3", title: "3. Vowel Check", code: `if (c=='a'||c=='e'...)` },
                { id: "cpp_4", title: "4. Quadratic", code: `d = b*b - 4*a*c;` },
                { id: "cpp_5", title: "5. Mult Table", code: `for(i=1;i<=10;i++)` },
                { id: "cpp_6", title: "6. Octal->Dec", code: `rem = oct % 10;` },
                { id: "cpp_7", title: "7. Structs", code: `struct s { char n[]; };` },
                { id: "cpp_8", title: "8. Filter String", code: `if (isalpha(line[i]))` },
                { id: "cpp_9", title: "9. Char Freq", code: `if(s[i]==c) count++;` },
                { id: "cpp_10", title: "10. Primes", code: `if(n%i==0) return false;` }
            ],
            sql: [
                { id: "sql_1", title: "1. Addition", code: `SELECT amt+100 FROM Order;` },
                { id: "sql_2", title: "2. Subtraction", code: `SELECT amt-20 FROM Order;` },
                { id: "sql_3", title: "3. Multiplication", code: `SELECT amt*4 FROM Order;` },
                { id: "sql_4", title: "4. Division", code: `SELECT amt/2 FROM Order;` },
                { id: "sql_5", title: "5. Stored Proc", code: `CREATE PROCEDURE x...` },
                { id: "sql_6", title: "6. Multi-Param", code: `WHERE id=x AND amt<y` },
                { id: "sql_7", title: "7. BETWEEN", code: `WHERE x BETWEEN 1 AND 10` }
            ],
            java: [
                { id: "java_1", title: "1. Quadratic", code: `x = (-b + Math.sqrt(d))/2a` },
                { id: "java_2", title: "2. Mult Table", code: `System.out.printf(...)` },
                { id: "java_3", title: "3. Calculator", code: `switch(op) { case '+': ... }` },
                { id: "java_4", title: "4. Recur Sum", code: `return n + add(n-1)` },
                { id: "java_5", title: "5. Recur Rev", code: `return rev(sub) + char` },
                { id: "java_6", title: "6. Array Avg", code: `for(double n : arr)` },
                { id: "java_7", title: "7. Matrix Add", code: `sum[i][j] = a[i][j]+b[i][j]` }
            ]
        };

        // --- APP LOGIC ---
        function switchTab(tab) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('active'));
            const btn = document.getElementById(`nav-${tab}`);
            if(btn) btn.classList.add('active');
            
            if(window.innerWidth < 768) document.getElementById('sidebar').classList.add('-translate-x-full');
            if(tab === 'dashboard') fetchProgress();
        }

        function renderExamples() {
            const createCard = (ex) => `
                <div class="glass-panel p-5 rounded-xl group hover:border-sky-500/50 transition duration-300 flex flex-col h-full">
                    <div class="flex justify-between items-start mb-3">
                        <h4 class="font-semibold text-sky-400 line-clamp-1">${ex.title}</h4>
                        <button onclick="openLogic('${ex.id}')" class="text-xs bg-sky-600 hover:bg-sky-500 text-white px-3 py-1 rounded shadow transition whitespace-nowrap ml-2">Logic</button>
                    </div>
                    <pre class="bg-[#0d1117] p-3 rounded text-xs overflow-x-auto border border-slate-800 flex-1"><code>${ex.code.replace(/</g, '&lt;')}</code></pre>
                    <div class="mt-4 text-right">
                        <button onclick="startPractice('${ex.title}')" class="text-xs text-slate-400 hover:text-emerald-400 flex items-center gap-2 ml-auto transition border border-slate-700 px-3 py-2 rounded hover:border-emerald-500/50">
                            <i class="fa-solid fa-pen-to-square"></i> Write Test
                        </button>
                    </div>
                </div>`;
            
            document.getElementById('python-examples').innerHTML = codeExamples.python.map(createCard).join('');
            document.getElementById('cpp-examples').innerHTML = codeExamples.cpp.map(createCard).join('');
            document.getElementById('sql-examples').innerHTML = codeExamples.sql.map(createCard).join('');
            document.getElementById('java-examples').innerHTML = codeExamples.java.map(createCard).join('');
        }

        function openLogic(id) {
            const modal = document.getElementById('logicModal');
            const body = document.getElementById('logicBody');
            
            // Fallback if logic is missing (prevents empty box)
            const content = logicData[id];
            if (content) {
                body.innerHTML = content;
            } else {
                body.innerHTML = `<div class="text-slate-400 p-4 text-center">Logic details coming soon for: <span class="text-sky-400 font-mono">${id}</span></div>`;
            }
            
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.querySelector('div').classList.remove('scale-95');
            modal.querySelector('div').classList.add('scale-100');
        }

        function startPractice(topic) {
            switchTab('practice');
            const input = document.getElementById('practiceTopic');
            input.value = topic;
            input.scrollIntoView({ behavior: 'smooth' });
            input.classList.add('ring-2', 'ring-emerald-500');
            setTimeout(() => input.classList.remove('ring-2', 'ring-emerald-500'), 1000);
        }

        async function fetchProgress() {
            try {
                const res = await fetch(`${API_URL}/progress`, { headers: { 'Authorization': localStorage.getItem('userToken') } });
                if(res.status === 403 || res.status === 401) return;
                if(!res.ok) throw new Error("Failed");
                
                const data = await res.json();
                const list = document.getElementById('progress-list');
                
                if(data.length === 0) {
                    list.innerHTML = '';
                    document.getElementById('no-progress-msg').classList.remove('hidden');
                } else {
                    document.getElementById('no-progress-msg').classList.add('hidden');
                    list.innerHTML = data.map(d => `
                        <div class="flex items-center justify-between p-3 bg-slate-800/40 rounded-lg border border-slate-700 hover:bg-slate-800 transition">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-emerald-500/20 text-emerald-400 flex items-center justify-center text-sm"><i class="fa-solid fa-check"></i></div>
                                <div>
                                    <div class="font-semibold text-sm text-white">${d.quizName}</div>
                                    <div class="text-xs text-slate-500">${new Date(d.completedAt).toLocaleDateString()}</div>
                                </div>
                            </div>
                            <span class="text-xs bg-sky-500/10 text-sky-400 px-2 py-1 rounded border border-sky-500/20">Practice</span>
                        </div>
                    `).join('');
                }
            } catch(e) { console.log("Offline"); }
        }

        document.getElementById('practiceForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitPracticeBtn');
            const result = document.getElementById('practiceResult');
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Saving...';

            try {
                const payload = { 
                    topic: document.getElementById('practiceTopic').value,
                    code: document.getElementById('practiceCode').value
                };
                
                const res = await fetch(`${API_URL}/activity/submit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': localStorage.getItem('userToken') },
                    body: JSON.stringify(payload)
                });

                if(res.ok) {
                    result.innerHTML = '<span class="text-emerald-400 font-bold"><i class="fa-solid fa-check-circle"></i> Saved!</span>';
                    result.classList.remove('hidden');
                    e.target.reset();
                    setTimeout(() => { switchTab('dashboard'); result.classList.add('hidden'); }, 1500);
                }
            } catch(err) {
                result.innerHTML = '<span class="text-red-400">Connection failed.</span>';
                result.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-save"></i> Save Progress';
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            renderExamples();
            fetchProgress();
            
            document.getElementById('mobileMenuBtn').addEventListener('click', () => document.getElementById('sidebar').classList.toggle('-translate-x-full'));
            document.getElementById('closeModal').addEventListener('click', () => {
                const modal = document.getElementById('logicModal');
                modal.classList.add('opacity-0', 'pointer-events-none');
                modal.querySelector('div').classList.add('scale-95');
                modal.querySelector('div').classList.remove('scale-100');
            });
            
            const email = localStorage.getItem('userEmail');
            if(email) document.getElementById('userEmailDisplay').innerText = email.split('@')[0];

            document.getElementById('logoutBtn').addEventListener('click', () => {
                localStorage.clear();
                window.location.href = 'login.html';
            });
        });
    </script>
</body>
</html>